---
name: improve-prompt
description: 优化提示词 - 结构化改写后立即执行，禁止扩展范围
---

# 优化提示词

> **铁律**: 你是结构优化助手，不是需求扩展者。改写提示词是手段，执行任务是目的。

## 核心约束（必须遵守）

**✅ 允许：**
- 重组句子结构，提升可读性
- 将隐含的步骤显式化
- 添加格式标记（列表、标题、代码块）

**❌ 禁止：**
- 扩展原始范围（不得添加用户未提及的需求）
- 添加虚构细节（不得猜测用户意图外的内容）
- 改变原意或目标
- 删除用户明确提到的要求

## 增强流程

### 步骤 1: 理解原意

分析用户提示词：
1. **核心目标** - 用户想达成什么？
2. **关键约束** - 有哪些明确限制？
3. **隐含步骤** - 逻辑上必须但未写明的环节
4. **模糊点** - 可能引起歧义的表述

### 步骤 1.5: 歧义检测（可选）

如检测到明显歧义（目标受众不明、输出格式不明、范围不明等），使用 `AskUserQuestion` 询问用户意图：

- **multiSelect**: true（用户可能需要多种解释的组合）
- 提供 2-3 个仅基于原始提示词语境的解释选项（不得引入新需求/新技术栈）
- 无歧义时跳过此步骤
- **多选合并**：用户选多个解释时，合并共同部分，冲突部分标注让用户确认

### 步骤 2: 结构化改写

按以下模板重组：

```markdown
## 目标
[一句话说明核心目标]

## 前提条件
- 条件 1
- 条件 2

## 执行步骤
1. **[步骤名]**: [具体操作]
   - 细节 A
   - 细节 B

2. **[步骤名]**: [具体操作]

## 输出要求
- 输出 1: [格式/内容说明]
- 输出 2: [格式/内容说明]

## 约束条件
- 禁止：[明确限制]
- 必须：[强制要求]
```

### 步骤 3: 验证对齐

对比原始提示词，确认：
- [ ] 所有原始要求已保留
- [ ] 未添加用户未提及的内容
- [ ] 逻辑顺序清晰
- [ ] 术语使用一致

## 输出格式

```markdown
### 📝 原始提示词
[用户的原始输入]

---

### ✨ 增强版提示词
[改写后的版本]

---

### 🔍 改进说明
- **结构优化**: [说明结构调整]
- **逻辑补充**: [说明补充的逻辑连接]
- **歧义消除**: [说明消除的模糊点]
- **保持不变**: [确认未扩展范围的声明]

### 💡 推荐工具（可选）
基于任务分析，以下工具**可选**，仅在不扩展原始需求/技术栈时提供（可包含 skills、slash commands、MCP 工具、sub agents）：
- [匹配到的工具推荐]

```

## 工具推荐逻辑

分析增强版提示词的任务性质，基于上下文智能推荐可能有帮助的工具：

**推荐原则**:
- 根据任务类型匹配相关的 skill、slash command、MCP 工具或 sub agent，且不得引入用户未提及的新能力/技术栈
- 优先推荐当前环境中可用的工具
- 每次推荐 1-3 个最相关的，避免信息过载

**推荐格式**: `工具名` - 简短理由

**无相关工具时**: 省略"💡 推荐工具"部分，不输出空推荐。

## 执行改写后的提示词

**完成改写后，立即执行以下操作**：

1. **输出改写结果**（让用户看到优化过程）
2. **分隔线标记**：输出 `---` 和 `## 执行改写后的任务` 标题
3. **执行增强版提示词**：将增强版作为新请求执行，直接给出任务结果（执行时不得新增工具/步骤/技术栈，严格限于用户原始范围）

**关键原则**：
- 改写提示词是手段，执行任务是目的
- 用户是为了得到更好的任务执行结果
- 不要让用户再次复制粘贴增强版提示词

## 快速检查清单

改写完成后，验证：
1. 原始提示词的每个要求是否都在增强版中？
2. 增强版是否引入了原始提示词没有的新需求？
3. 技术细节（工具、命令、参数）是否保持原样？
4. 逻辑顺序是否比原版更清晰？
5. 如存在完全贴合且不扩展范围的工具，是否进行了可选推荐？（无匹配则省略，不强求推荐）

**记住：** 你是结构优化助手，不是需求扩展者。
