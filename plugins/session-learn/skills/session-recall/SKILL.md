---
name: session-recall
description: 查询 Memory MCP 并将相关学习注入当前会话 - 用于 Claude Code 似乎忘记了什么的时候
---

# 会话召回技能

查询 Memory MCP，检索相关学习并注入当前会话上下文。

## 触发场景

用户可能**感到烦躁**，因为：
- 你似乎忘记了之前学过的东西
- 你在重复之前被纠正过的错误
- 你在走之前已证明行不通的方向
- 你在忽略用户已表达过的偏好

**核心目的**：让你回顾已学习的内容，这样用户就不用再解释一遍。

## 执行步骤

### 第一步：理解上下文

分析用户为什么调用 `/recall`：
- 当前任务/讨论是关于什么的？
- 你可能哪里做错了？
- 哪些关键词与问题相关？

如果用户提供了参数（如 `/recall 认证模式`），用它们作为主要关键词。

### 第二步：查询 Memory MCP

使用 `search_nodes` 查找相关实体：

```
mcp__memory__search_nodes
- query: [提取的关键词]
```

搜索策略：
- 先宽泛搜索，结果太多再缩小范围
- 尝试多个相关词
- 中英文都试试

### 第三步：获取详情

使用 `open_nodes` 获取相关实体的完整内容：

```
mcp__memory__open_nodes
- names: [搜索结果中的实体名称]
```

### 第四步：格式化并展示

清晰地展示发现：

```markdown
## 召回的学习

我回顾了之前的学习记录，找到：

### 交互模式
- [模式 1]：[详情]

### 问题解决方法
- [方法 1]：[详情]

### 历史经验
- [经验 1]：[详情]

---

**应用到当前情况**：基于这些学习，我应该 [具体调整当前方法]。
```

### 第五步：确认并调整

明确说明：
1. 找到了什么相关内容
2. 如何应用到当前情况
3. 接下来会怎样做

示例：
> "我回顾了之前的记录，发现你偏好简洁的响应，不需要冗长的解释。我会相应调整我的沟通风格。"

## 查询策略

### 按主题
如果用户提供了主题：`/recall 代码风格`
- 搜索："代码风格"、"code style"、"coding"

### 按上下文
如果没有提供主题：
- 从最近的对话中提取关键词
- 寻找与当前任务相关的模式

### 按挫败感指标
如果用户似乎很烦躁：
- 搜索之前的纠正/分歧
- 寻找 "用户偏好"、"用户不喜欢"

## Memory MCP 工具参考

```
# 搜索实体
mcp__memory__search_nodes
参数：
- query: string（搜索词）

# 打开特定实体
mcp__memory__open_nodes
参数：
- names: string[]（要检索的实体名称）

# 读取整个图谱（谨慎使用 - 数据量大）
mcp__memory__read_graph
```

## 响应模板

```markdown
## 回顾历史学习

我查询了 Memory MCP，找到以下相关记录：

### 发现
[列出找到的内容]

### 与当前情况的关联
[解释发现与当前上下文的关系]

### 调整
[说明基于此召回你会怎样做]
```

## 边界情况

### 没有找到结果
```markdown
我查询了 Memory MCP，但没有找到与 "[主题]" 相关的历史学习记录。

可能原因：
- 这个话题还没有被学习过
- 使用不同的关键词可能有帮助

你能告诉我具体是什么情况吗？
```

### Memory MCP 不可用
```markdown
Memory MCP 当前不可用，无法查询历史学习。

请检查 Memory MCP 服务器是否正在运行。
```

### 结果太多
根据以下优先级聚焦最相关的：
1. 时间（最近的优先）
2. 与当前上下文的关联度
3. 实体类型（行为问题时 interaction_pattern > learning_history）
