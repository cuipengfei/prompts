# Proposal: Simplify Desktop Notify

## Why

å½“å‰ `desktop-notify` æ’ä»¶ä½¿ç”¨ 400 è¡Œ Bash è„šæœ¬ + PowerShell å®ç° Windows Toast é€šçŸ¥ï¼š

**é—®é¢˜ï¼š**
1. **å¹³å°é™åˆ¶** - ä»…æ”¯æŒ WSLï¼Œå®¹å™¨ç¯å¢ƒæ— æ³•ä½¿ç”¨ï¼ˆæ—  PowerShellï¼‰
2. **ä»£ç è‡ƒè‚¿** - 400 è¡Œ Bash åš JSON è§£æã€XML æ„å»ºã€æ—¥å¿—ç®¡ç†
3. **ä¾èµ–è¿‡é‡** - éœ€è¦ jqã€PowerShellã€WSL interop
4. **ç»´æŠ¤å›°éš¾** - Bash å­—ç¬¦ä¸²å¤„ç†è„†å¼±ï¼Œè°ƒè¯•å›°éš¾

**ç›®æ ‡ï¼š**
- ç®€åŒ–åˆ° ~100 è¡Œ TypeScriptï¼ˆBunï¼‰
- æ”¯æŒå®¹å™¨ã€WSLã€ä»»ä½•æœ‰ Bun çš„ç¯å¢ƒ
- é›¶å¤–éƒ¨ä¾èµ–ï¼ˆä¼ä¸šå‹å¥½ï¼Œæ— éœ€è¿æ¥å¤–éƒ¨æœåŠ¡ï¼‰
- åˆ©ç”¨æµè§ˆå™¨ Web Notification API å®ç°è·¨å¹³å°é€šçŸ¥

## What Changes

### æ¶æ„è½¬å˜

```
æ—§æ–¹æ¡ˆ (Bash + PowerShell):
Hook â†’ Bash è„šæœ¬ â†’ jq è§£æ â†’ PowerShell â†’ Windows Toast

æ–°æ–¹æ¡ˆ (Bun + SSE):
Hook â†’ Bun è„šæœ¬ â†’ HTTP POST â†’ SSE â†’ æµè§ˆå™¨ â†’ Web Notification
```

### æ–°è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Container / WSL                     â”‚
â”‚                                      â”‚
â”‚  Claude Code â”€â”€curlâ”€â”€â–¶ Bun :9999    â”‚
â”‚     hook                 â†‘          â”‚
â”‚                    notify.ts         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ port mapping
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Windows/Mac: Chrome tab             â”‚
â”‚  http://localhost:9999              â”‚
â”‚  SSE â”€â”€â–¶ Web Notification ğŸ””        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒç‰¹æ€§ï¼š**
1. **å•æ–‡ä»¶åŒæ¨¡å¼** - `notify.ts` æ—¢æ˜¯æœåŠ¡å™¨ä¹Ÿæ˜¯å®¢æˆ·ç«¯
2. **è‡ªå¯åŠ¨** - Hook è§¦å‘æ—¶è‡ªåŠ¨æ£€æµ‹å¹¶å¯åŠ¨æœåŠ¡
3. **SSE æ¨é€** - å®æ—¶é€šçŸ¥åˆ°æµè§ˆå™¨
4. **Web Notification** - è·¨å¹³å°åŸç”Ÿé€šçŸ¥å¼¹çª—

### é€šçŸ¥å†…å®¹

- Stop: `cc: {project} - âœ“ å®Œæˆ`
- Notification: `cc: {project} - â³ ç­‰å¾…è¾“å…¥`

## Viability Tests

åœ¨ç¼–ç å‰éœ€éªŒè¯ä»¥ä¸‹æŠ€æœ¯å‡è®¾ï¼š

### Test 1: Bun åœ¨å®¹å™¨ä¸­çš„å¯ç”¨æ€§
```bash
# åœ¨å…¸å‹ Claude Code å®¹å™¨é•œåƒä¸­æ£€æŸ¥
docker run -it ubuntu:22.04 bash -c "curl -fsSL https://bun.sh/install | bash && ~/.bun/bin/bun --version"
```
**éªŒè¯ç‚¹ï¼š** Bun å¯åœ¨æ—  Node.js çš„å®¹å™¨ä¸­å®‰è£…è¿è¡Œ

### Test 2: SSE è¿æ¥ç¨³å®šæ€§
```bash
# æµ‹è¯• SSE é•¿è¿æ¥åœ¨æµè§ˆå™¨ tab åå°æ—¶æ˜¯å¦ä¿æŒ
# åˆ›å»ºç®€å• SSE æœåŠ¡å™¨ï¼Œåå° tab 10 åˆ†é’Ÿåå‘é€æ¶ˆæ¯
```
**éªŒè¯ç‚¹ï¼š** æµè§ˆå™¨åå° tab èƒ½æ¥æ”¶ SSE æ¶ˆæ¯

### Test 3: Web Notification æƒé™æŒä¹…æ€§
```javascript
// éªŒè¯ä¸€æ¬¡æˆæƒåï¼Œåˆ·æ–°é¡µé¢æ˜¯å¦ä¿æŒæƒé™
Notification.permission // åº”è¯¥æ˜¯ "granted"
```
**éªŒè¯ç‚¹ï¼š** ç”¨æˆ·åªéœ€æˆæƒä¸€æ¬¡

### Test 4: ç«¯å£æ˜ å°„è‡ªåŠ¨æ€§
```bash
# WSL ä¸­å¯åŠ¨æœåŠ¡ï¼ŒWindows æµè§ˆå™¨è®¿é—®
bun -e "Bun.serve({port:9999,fetch:()=>new Response('ok')})"
# Windows: curl http://localhost:9999
```
**éªŒè¯ç‚¹ï¼š** WSL ç«¯å£è‡ªåŠ¨æ˜ å°„åˆ° Windowsï¼ˆæ— éœ€é¢å¤–é…ç½®ï¼‰

### Test 5: è¿›ç¨‹åˆ†ç¦»å¯é æ€§
```typescript
// éªŒè¯ detached spawn åœ¨ hook é€€å‡ºåç»§ç»­è¿è¡Œ
Bun.spawn(["bun", "server.ts"], { detached: true, stdout: "ignore" });
```
**éªŒè¯ç‚¹ï¼š** æœåŠ¡è¿›ç¨‹ç‹¬ç«‹äº hook è¿›ç¨‹å­˜æ´»

## Scope

- **IN**: desktop-notify æ’ä»¶é‡å†™
- **OUT**: å…¶ä»–æ’ä»¶ä¸å—å½±å“

## Risks

| é£é™© | ç¼“è§£æªæ–½ |
|------|----------|
| Bun æœªå®‰è£… | æä¾› fallback æˆ–å®‰è£…æŒ‡å¼• |
| ç«¯å£ 9999 è¢«å ç”¨ | æ”¯æŒç¯å¢ƒå˜é‡é…ç½®ç«¯å£ |
| æµè§ˆå™¨ tab è¢«å…³é—­ | é€šçŸ¥ä¸å¯è¾¾ï¼Œä½†ä¸å½±å“ Claude Code |
